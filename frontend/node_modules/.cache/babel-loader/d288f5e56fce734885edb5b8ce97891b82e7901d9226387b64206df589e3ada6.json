{"ast":null,"code":"import _defineProperty from '@babel/runtime/helpers/esm/defineProperty';\nimport { Pass, FullScreenQuad } from './Pass.js';\nimport { WebGLRenderTarget, NearestFilter, MeshDepthMaterial, RGBADepthPacking, NoBlending, UniformsUtils, ShaderMaterial, Color } from 'three';\nimport { BokehShader } from '../shaders/BokehShader.js';\nclass BokehPass extends Pass {\n  constructor(scene, camera, params) {\n    super();\n    _defineProperty(this, \"scene\", void 0);\n    _defineProperty(this, \"camera\", void 0);\n    _defineProperty(this, \"renderTargetDepth\", void 0);\n    _defineProperty(this, \"materialDepth\", void 0);\n    _defineProperty(this, \"materialBokeh\", void 0);\n    _defineProperty(this, \"fsQuad\", void 0);\n    _defineProperty(this, \"_oldClearColor\", void 0);\n    _defineProperty(this, \"uniforms\", void 0);\n    this.scene = scene;\n    this.camera = camera;\n    const focus = params.focus !== undefined ? params.focus : 1.0;\n    const aspect = params.aspect !== undefined ? params.aspect : camera.aspect;\n    const aperture = params.aperture !== undefined ? params.aperture : 0.025;\n    const maxblur = params.maxblur !== undefined ? params.maxblur : 1.0; // render targets\n\n    const width = params.width || window.innerWidth || 1;\n    const height = params.height || window.innerHeight || 1;\n    this.renderTargetDepth = new WebGLRenderTarget(width, height, {\n      minFilter: NearestFilter,\n      magFilter: NearestFilter\n    });\n    this.renderTargetDepth.texture.name = 'BokehPass.depth'; // depth material\n\n    this.materialDepth = new MeshDepthMaterial();\n    this.materialDepth.depthPacking = RGBADepthPacking;\n    this.materialDepth.blending = NoBlending; // bokeh material\n\n    if (BokehShader === undefined) {\n      console.error('BokehPass relies on BokehShader');\n    }\n    const bokehShader = BokehShader;\n    const bokehUniforms = UniformsUtils.clone(bokehShader.uniforms);\n    bokehUniforms['tDepth'].value = this.renderTargetDepth.texture;\n    bokehUniforms['focus'].value = focus;\n    bokehUniforms['aspect'].value = aspect;\n    bokehUniforms['aperture'].value = aperture;\n    bokehUniforms['maxblur'].value = maxblur;\n    bokehUniforms['nearClip'].value = camera.near;\n    bokehUniforms['farClip'].value = camera.far;\n    this.materialBokeh = new ShaderMaterial({\n      defines: Object.assign({}, bokehShader.defines),\n      uniforms: bokehUniforms,\n      vertexShader: bokehShader.vertexShader,\n      fragmentShader: bokehShader.fragmentShader\n    });\n    this.uniforms = bokehUniforms;\n    this.needsSwap = false;\n    this.fsQuad = new FullScreenQuad(this.materialBokeh);\n    this._oldClearColor = new Color();\n  }\n  render(renderer, writeBuffer, readBuffer\n  /*, deltaTime, maskActive */) {\n    // Render depth into texture\n    this.scene.overrideMaterial = this.materialDepth;\n    renderer.getClearColor(this._oldClearColor);\n    const oldClearAlpha = renderer.getClearAlpha();\n    const oldAutoClear = renderer.autoClear;\n    renderer.autoClear = false;\n    renderer.setClearColor(0xffffff);\n    renderer.setClearAlpha(1.0);\n    renderer.setRenderTarget(this.renderTargetDepth);\n    renderer.clear();\n    renderer.render(this.scene, this.camera); // Render bokeh composite\n\n    this.uniforms['tColor'].value = readBuffer.texture;\n    this.uniforms['nearClip'].value = this.camera.near;\n    this.uniforms['farClip'].value = this.camera.far;\n    if (this.renderToScreen) {\n      renderer.setRenderTarget(null);\n      this.fsQuad.render(renderer);\n    } else {\n      renderer.setRenderTarget(writeBuffer);\n      renderer.clear();\n      this.fsQuad.render(renderer);\n    }\n    this.scene.overrideMaterial = null;\n    renderer.setClearColor(this._oldClearColor);\n    renderer.setClearAlpha(oldClearAlpha);\n    renderer.autoClear = oldAutoClear;\n  }\n}\nexport { BokehPass };","map":{"version":3,"names":["_defineProperty","Pass","FullScreenQuad","WebGLRenderTarget","NearestFilter","MeshDepthMaterial","RGBADepthPacking","NoBlending","UniformsUtils","ShaderMaterial","Color","BokehShader","BokehPass","constructor","scene","camera","params","focus","undefined","aspect","aperture","maxblur","width","window","innerWidth","height","innerHeight","renderTargetDepth","minFilter","magFilter","texture","name","materialDepth","depthPacking","blending","console","error","bokehShader","bokehUniforms","clone","uniforms","value","near","far","materialBokeh","defines","Object","assign","vertexShader","fragmentShader","needsSwap","fsQuad","_oldClearColor","render","renderer","writeBuffer","readBuffer","overrideMaterial","getClearColor","oldClearAlpha","getClearAlpha","oldAutoClear","autoClear","setClearColor","setClearAlpha","setRenderTarget","clear","renderToScreen"],"sources":["/Users/tumolabsstudent/Desktop/app/node_modules/three-stdlib/postprocessing/BokehPass.js"],"sourcesContent":["import _defineProperty from '@babel/runtime/helpers/esm/defineProperty';\nimport { Pass, FullScreenQuad } from './Pass.js';\nimport { WebGLRenderTarget, NearestFilter, MeshDepthMaterial, RGBADepthPacking, NoBlending, UniformsUtils, ShaderMaterial, Color } from 'three';\nimport { BokehShader } from '../shaders/BokehShader.js';\n\nclass BokehPass extends Pass {\n  constructor(scene, camera, params) {\n    super();\n\n    _defineProperty(this, \"scene\", void 0);\n\n    _defineProperty(this, \"camera\", void 0);\n\n    _defineProperty(this, \"renderTargetDepth\", void 0);\n\n    _defineProperty(this, \"materialDepth\", void 0);\n\n    _defineProperty(this, \"materialBokeh\", void 0);\n\n    _defineProperty(this, \"fsQuad\", void 0);\n\n    _defineProperty(this, \"_oldClearColor\", void 0);\n\n    _defineProperty(this, \"uniforms\", void 0);\n\n    this.scene = scene;\n    this.camera = camera;\n    const focus = params.focus !== undefined ? params.focus : 1.0;\n    const aspect = params.aspect !== undefined ? params.aspect : camera.aspect;\n    const aperture = params.aperture !== undefined ? params.aperture : 0.025;\n    const maxblur = params.maxblur !== undefined ? params.maxblur : 1.0; // render targets\n\n    const width = params.width || window.innerWidth || 1;\n    const height = params.height || window.innerHeight || 1;\n    this.renderTargetDepth = new WebGLRenderTarget(width, height, {\n      minFilter: NearestFilter,\n      magFilter: NearestFilter\n    });\n    this.renderTargetDepth.texture.name = 'BokehPass.depth'; // depth material\n\n    this.materialDepth = new MeshDepthMaterial();\n    this.materialDepth.depthPacking = RGBADepthPacking;\n    this.materialDepth.blending = NoBlending; // bokeh material\n\n    if (BokehShader === undefined) {\n      console.error('BokehPass relies on BokehShader');\n    }\n\n    const bokehShader = BokehShader;\n    const bokehUniforms = UniformsUtils.clone(bokehShader.uniforms);\n    bokehUniforms['tDepth'].value = this.renderTargetDepth.texture;\n    bokehUniforms['focus'].value = focus;\n    bokehUniforms['aspect'].value = aspect;\n    bokehUniforms['aperture'].value = aperture;\n    bokehUniforms['maxblur'].value = maxblur;\n    bokehUniforms['nearClip'].value = camera.near;\n    bokehUniforms['farClip'].value = camera.far;\n    this.materialBokeh = new ShaderMaterial({\n      defines: Object.assign({}, bokehShader.defines),\n      uniforms: bokehUniforms,\n      vertexShader: bokehShader.vertexShader,\n      fragmentShader: bokehShader.fragmentShader\n    });\n    this.uniforms = bokehUniforms;\n    this.needsSwap = false;\n    this.fsQuad = new FullScreenQuad(this.materialBokeh);\n    this._oldClearColor = new Color();\n  }\n\n  render(renderer, writeBuffer, readBuffer\n  /*, deltaTime, maskActive */\n  ) {\n    // Render depth into texture\n    this.scene.overrideMaterial = this.materialDepth;\n    renderer.getClearColor(this._oldClearColor);\n    const oldClearAlpha = renderer.getClearAlpha();\n    const oldAutoClear = renderer.autoClear;\n    renderer.autoClear = false;\n    renderer.setClearColor(0xffffff);\n    renderer.setClearAlpha(1.0);\n    renderer.setRenderTarget(this.renderTargetDepth);\n    renderer.clear();\n    renderer.render(this.scene, this.camera); // Render bokeh composite\n\n    this.uniforms['tColor'].value = readBuffer.texture;\n    this.uniforms['nearClip'].value = this.camera.near;\n    this.uniforms['farClip'].value = this.camera.far;\n\n    if (this.renderToScreen) {\n      renderer.setRenderTarget(null);\n      this.fsQuad.render(renderer);\n    } else {\n      renderer.setRenderTarget(writeBuffer);\n      renderer.clear();\n      this.fsQuad.render(renderer);\n    }\n\n    this.scene.overrideMaterial = null;\n    renderer.setClearColor(this._oldClearColor);\n    renderer.setClearAlpha(oldClearAlpha);\n    renderer.autoClear = oldAutoClear;\n  }\n\n}\n\nexport { BokehPass };\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}