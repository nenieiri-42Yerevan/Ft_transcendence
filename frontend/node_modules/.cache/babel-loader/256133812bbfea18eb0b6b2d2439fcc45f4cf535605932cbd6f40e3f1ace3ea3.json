{"ast":null,"code":"import { Color, DepthTexture, UnsignedShortType, NearestFilter, WebGLRenderTarget, LinearFilter, RGBAFormat, HalfFloatType, ShaderMaterial, UniformsUtils, NoBlending, MeshNormalMaterial, MeshBasicMaterial, SrcAlphaFactor, OneMinusSrcAlphaFactor, AddEquation, NormalBlending } from 'three';\nimport { FullScreenQuad, Pass } from './Pass.js';\nimport { SSRShader, SSRBlurShader, SSRDepthShader } from '../shaders/SSRShader.js';\nimport { CopyShader } from '../shaders/CopyShader.js';\nvar SSRPass = function (_ref) {\n  let {\n    renderer,\n    scene,\n    camera,\n    width,\n    height,\n    selects,\n    encoding,\n    isPerspectiveCamera = true,\n    isBouncing = false,\n    morphTargets = false,\n    groundReflector\n  } = _ref;\n  this.width = width !== undefined ? width : 512;\n  this.height = height !== undefined ? height : 512;\n  this.clear = true;\n  this.renderer = renderer;\n  this.scene = scene;\n  this.camera = camera;\n  this.groundReflector = groundReflector;\n  this.opacity = SSRShader.uniforms.opacity.value;\n  this.output = 0;\n  this.maxDistance = SSRShader.uniforms.maxDistance.value;\n  this.surfDist = SSRShader.uniforms.surfDist.value;\n  this.encoding = encoding;\n  this.tempColor = new Color();\n  this._selects = selects;\n  this.isSelective = Array.isArray(this._selects);\n  Object.defineProperty(this, 'selects', {\n    get() {\n      return this._selects;\n    },\n    set(val) {\n      if (this._selects === val) return;\n      this._selects = val;\n      if (Array.isArray(val)) {\n        this.isSelective = true;\n        this.ssrMaterial.defines.isSelective = true;\n        this.ssrMaterial.needsUpdate = true;\n      } else {\n        this.isSelective = false;\n        this.ssrMaterial.defines.isSelective = false;\n        this.ssrMaterial.needsUpdate = true;\n      }\n    }\n  });\n  this._isBouncing = isBouncing; ///todo: don't need defineProperty\n\n  Object.defineProperty(this, 'isBouncing', {\n    get() {\n      return this._isBouncing;\n    },\n    set(val) {\n      if (this._isBouncing === val) return;\n      this._isBouncing = val;\n      if (val) {\n        this.ssrMaterial.uniforms['tDiffuse'].value = this.prevRenderTarget.texture;\n      } else {\n        this.ssrMaterial.uniforms['tDiffuse'].value = this.beautyRenderTarget.texture;\n      }\n    }\n  });\n  this.isBlur = true;\n  this._isDistanceAttenuation = SSRShader.defines.isDistanceAttenuation;\n  Object.defineProperty(this, 'isDistanceAttenuation', {\n    get() {\n      return this._isDistanceAttenuation;\n    },\n    set(val) {\n      if (this._isDistanceAttenuation === val) return;\n      this._isDistanceAttenuation = val;\n      this.ssrMaterial.defines.isDistanceAttenuation = val;\n      this.ssrMaterial.needsUpdate = true;\n    }\n  });\n  this._isFresnel = SSRShader.defines.isFresnel;\n  Object.defineProperty(this, 'isFresnel', {\n    get() {\n      return this._isFresnel;\n    },\n    set(val) {\n      if (this._isFresnel === val) return;\n      this._isFresnel = val;\n      this.ssrMaterial.defines.isFresnel = val;\n      this.ssrMaterial.needsUpdate = true;\n    }\n  });\n  this._isInfiniteThick = SSRShader.defines.isInfiniteThick;\n  Object.defineProperty(this, 'isInfiniteThick', {\n    get() {\n      return this._isInfiniteThick;\n    },\n    set(val) {\n      if (this._isInfiniteThick === val) return;\n      this._isInfiniteThick = val;\n      this.ssrMaterial.defines.isInfiniteThick = val;\n      this.ssrMaterial.needsUpdate = true;\n    }\n  });\n  this.thickTolerance = SSRShader.uniforms.thickTolerance.value; // beauty render target with depth buffer\n\n  var depthTexture = new DepthTexture();\n  depthTexture.type = UnsignedShortType;\n  depthTexture.minFilter = NearestFilter;\n  depthTexture.maxFilter = NearestFilter;\n  this.beautyRenderTarget = new WebGLRenderTarget(this.width, this.height, {\n    minFilter: LinearFilter,\n    magFilter: LinearFilter,\n    format: RGBAFormat,\n    depthTexture: depthTexture,\n    depthBuffer: true\n  }); //for bouncing\n\n  this.prevRenderTarget = new WebGLRenderTarget(this.width, this.height, {\n    minFilter: LinearFilter,\n    magFilter: LinearFilter,\n    format: RGBAFormat\n  }); // normal render target\n\n  this.normalRenderTarget = new WebGLRenderTarget(this.width, this.height, {\n    minFilter: NearestFilter,\n    magFilter: NearestFilter,\n    format: RGBAFormat,\n    type: HalfFloatType\n  }); // metalness render target\n  // if (this.isSelective) {\n\n  this.metalnessRenderTarget = new WebGLRenderTarget(this.width, this.height, {\n    minFilter: NearestFilter,\n    magFilter: NearestFilter,\n    format: RGBAFormat\n  }); // }\n  // ssr render target\n\n  this.ssrRenderTarget = new WebGLRenderTarget(this.width, this.height, {\n    minFilter: LinearFilter,\n    magFilter: LinearFilter,\n    format: RGBAFormat\n  });\n  this.blurRenderTarget = this.ssrRenderTarget.clone();\n  this.blurRenderTarget2 = this.ssrRenderTarget.clone(); // this.blurRenderTarget3 = this.ssrRenderTarget.clone();\n  // ssr material\n\n  if (SSRShader === undefined) {\n    console.error('THREE.SSRPass: The pass relies on SSRShader.');\n  }\n  this.ssrMaterial = new ShaderMaterial({\n    defines: Object.assign({\n      MAX_STEP: Math.sqrt(window.innerWidth * window.innerWidth + window.innerHeight * window.innerHeight)\n    }, SSRShader.defines),\n    uniforms: UniformsUtils.clone(SSRShader.uniforms),\n    vertexShader: SSRShader.vertexShader,\n    fragmentShader: SSRShader.fragmentShader,\n    blending: NoBlending\n  });\n  if (!isPerspectiveCamera) {\n    this.ssrMaterial.defines.isPerspectiveCamera = isPerspectiveCamera;\n    this.ssrMaterial.needsUpdate = true;\n  }\n  this.ssrMaterial.uniforms['tDiffuse'].value = this.beautyRenderTarget.texture;\n  this.ssrMaterial.uniforms['tNormal'].value = this.normalRenderTarget.texture; // if (this.isSelective) {\n\n  this.ssrMaterial.defines.isSelective = this.isSelective;\n  this.ssrMaterial.needsUpdate = true;\n  this.ssrMaterial.uniforms['tMetalness'].value = this.metalnessRenderTarget.texture; // }\n\n  this.ssrMaterial.uniforms['tDepth'].value = this.beautyRenderTarget.depthTexture;\n  this.ssrMaterial.uniforms['cameraNear'].value = this.camera.near;\n  this.ssrMaterial.uniforms['cameraFar'].value = this.camera.far;\n  this.ssrMaterial.uniforms['surfDist'].value = this.surfDist;\n  this.ssrMaterial.uniforms['resolution'].value.set(this.width, this.height);\n  this.ssrMaterial.uniforms['cameraProjectionMatrix'].value.copy(this.camera.projectionMatrix);\n  this.ssrMaterial.uniforms['cameraInverseProjectionMatrix'].value.copy(this.camera.projectionMatrixInverse); // normal material\n\n  this.normalMaterial = new MeshNormalMaterial({\n    morphTargets\n  });\n  this.normalMaterial.blending = NoBlending; // if (this.isSelective) {\n  // metalnessOn material\n\n  this.metalnessOnMaterial = new MeshBasicMaterial({\n    color: 'white'\n  }); // metalnessOff material\n\n  this.metalnessOffMaterial = new MeshBasicMaterial({\n    color: 'black'\n  }); // }\n  // blur material\n\n  this.blurMaterial = new ShaderMaterial({\n    defines: Object.assign({}, SSRBlurShader.defines),\n    uniforms: UniformsUtils.clone(SSRBlurShader.uniforms),\n    vertexShader: SSRBlurShader.vertexShader,\n    fragmentShader: SSRBlurShader.fragmentShader\n  });\n  this.blurMaterial.uniforms['tDiffuse'].value = this.ssrRenderTarget.texture;\n  this.blurMaterial.uniforms['resolution'].value.set(this.width, this.height); // blur material 2\n\n  this.blurMaterial2 = new ShaderMaterial({\n    defines: Object.assign({}, SSRBlurShader.defines),\n    uniforms: UniformsUtils.clone(SSRBlurShader.uniforms),\n    vertexShader: SSRBlurShader.vertexShader,\n    fragmentShader: SSRBlurShader.fragmentShader\n  });\n  this.blurMaterial2.uniforms['tDiffuse'].value = this.blurRenderTarget.texture;\n  this.blurMaterial2.uniforms['resolution'].value.set(this.width, this.height); // // blur material 3\n  // this.blurMaterial3 = new ShaderMaterial({\n  //   defines: Object.assign({}, SSRBlurShader.defines),\n  //   uniforms: UniformsUtils.clone(SSRBlurShader.uniforms),\n  //   vertexShader: SSRBlurShader.vertexShader,\n  //   fragmentShader: SSRBlurShader.fragmentShader\n  // });\n  // this.blurMaterial3.uniforms['tDiffuse'].value = this.blurRenderTarget2.texture;\n  // this.blurMaterial3.uniforms['resolution'].value.set(this.width, this.height);\n  // material for rendering the depth\n\n  this.depthRenderMaterial = new ShaderMaterial({\n    defines: Object.assign({}, SSRDepthShader.defines),\n    uniforms: UniformsUtils.clone(SSRDepthShader.uniforms),\n    vertexShader: SSRDepthShader.vertexShader,\n    fragmentShader: SSRDepthShader.fragmentShader,\n    blending: NoBlending\n  });\n  this.depthRenderMaterial.uniforms['tDepth'].value = this.beautyRenderTarget.depthTexture;\n  this.depthRenderMaterial.uniforms['cameraNear'].value = this.camera.near;\n  this.depthRenderMaterial.uniforms['cameraFar'].value = this.camera.far; // material for rendering the content of a render target\n\n  this.copyMaterial = new ShaderMaterial({\n    uniforms: UniformsUtils.clone(CopyShader.uniforms),\n    vertexShader: CopyShader.vertexShader,\n    fragmentShader: CopyShader.fragmentShader,\n    transparent: true,\n    depthTest: false,\n    depthWrite: false,\n    blendSrc: SrcAlphaFactor,\n    blendDst: OneMinusSrcAlphaFactor,\n    blendEquation: AddEquation,\n    blendSrcAlpha: SrcAlphaFactor,\n    blendDstAlpha: OneMinusSrcAlphaFactor,\n    blendEquationAlpha: AddEquation // premultipliedAlpha:true,\n  });\n\n  this.fsQuad = new FullScreenQuad(null);\n  this.originalClearColor = new Color();\n};\nSSRPass.prototype = Object.assign(Object.create(Pass.prototype), {\n  constructor: SSRPass,\n  dispose: function () {\n    // dispose render targets\n    this.beautyRenderTarget.dispose();\n    this.prevRenderTarget.dispose();\n    this.normalRenderTarget.dispose(); // if (this.isSelective)\n\n    this.metalnessRenderTarget.dispose();\n    this.ssrRenderTarget.dispose();\n    this.blurRenderTarget.dispose();\n    this.blurRenderTarget2.dispose(); // this.blurRenderTarget3.dispose();\n    // dispose materials\n\n    this.normalMaterial.dispose(); // if (this.isSelective) {\n\n    this.metalnessOnMaterial.dispose();\n    this.metalnessOffMaterial.dispose(); // }\n\n    this.blurMaterial.dispose();\n    this.blurMaterial2.dispose();\n    this.copyMaterial.dispose();\n    this.depthRenderMaterial.dispose(); // dipsose full screen quad\n\n    this.fsQuad.dispose();\n  },\n  render: function (renderer, writeBuffer\n  /*, readBuffer, deltaTime, maskActive */) {\n    // render beauty and depth\n    if (this.encoding) this.beautyRenderTarget.texture.encoding = this.encoding;\n    renderer.setRenderTarget(this.beautyRenderTarget);\n    renderer.clear();\n    if (this.groundReflector) {\n      this.groundReflector.doRender(this.renderer, this.scene, this.camera);\n      this.groundReflector.visible = true;\n    }\n    renderer.render(this.scene, this.camera);\n    if (this.groundReflector) this.groundReflector.visible = false; // render normals\n\n    this.renderOverride(renderer, this.normalMaterial, this.normalRenderTarget, 0, 0); // render metalnesses\n\n    if (this.isSelective) {\n      this.renderMetalness(renderer, this.metalnessOnMaterial, this.metalnessRenderTarget, 0, 0);\n    } // render SSR\n\n    this.ssrMaterial.uniforms['opacity'].value = this.opacity;\n    this.ssrMaterial.uniforms['maxDistance'].value = this.maxDistance;\n    this.ssrMaterial.uniforms['surfDist'].value = this.surfDist;\n    this.ssrMaterial.uniforms['thickTolerance'].value = this.thickTolerance;\n    this.renderPass(renderer, this.ssrMaterial, this.ssrRenderTarget); // render blur\n\n    if (this.isBlur) {\n      this.renderPass(renderer, this.blurMaterial, this.blurRenderTarget);\n      this.renderPass(renderer, this.blurMaterial2, this.blurRenderTarget2); // this.renderPass(renderer, this.blurMaterial3, this.blurRenderTarget3);\n    } // output result to screen\n\n    switch (this.output) {\n      case SSRPass.OUTPUT.Default:\n        if (this.isBouncing) {\n          this.copyMaterial.uniforms['tDiffuse'].value = this.beautyRenderTarget.texture;\n          this.copyMaterial.blending = NoBlending;\n          this.renderPass(renderer, this.copyMaterial, this.prevRenderTarget);\n          if (this.isBlur) this.copyMaterial.uniforms['tDiffuse'].value = this.blurRenderTarget2.texture;else this.copyMaterial.uniforms['tDiffuse'].value = this.ssrRenderTarget.texture;\n          this.copyMaterial.blending = NormalBlending;\n          this.renderPass(renderer, this.copyMaterial, this.prevRenderTarget);\n          this.copyMaterial.uniforms['tDiffuse'].value = this.prevRenderTarget.texture;\n          this.copyMaterial.blending = NoBlending;\n          this.renderPass(renderer, this.copyMaterial, this.renderToScreen ? null : writeBuffer);\n        } else {\n          this.copyMaterial.uniforms['tDiffuse'].value = this.beautyRenderTarget.texture;\n          this.copyMaterial.blending = NoBlending;\n          this.renderPass(renderer, this.copyMaterial, this.renderToScreen ? null : writeBuffer);\n          if (this.isBlur) this.copyMaterial.uniforms['tDiffuse'].value = this.blurRenderTarget2.texture;else this.copyMaterial.uniforms['tDiffuse'].value = this.ssrRenderTarget.texture;\n          this.copyMaterial.blending = NormalBlending;\n          this.renderPass(renderer, this.copyMaterial, this.renderToScreen ? null : writeBuffer);\n        }\n        break;\n      case SSRPass.OUTPUT.SSR:\n        if (this.isBlur) this.copyMaterial.uniforms['tDiffuse'].value = this.blurRenderTarget2.texture;else this.copyMaterial.uniforms['tDiffuse'].value = this.ssrRenderTarget.texture;\n        this.copyMaterial.blending = NoBlending;\n        this.renderPass(renderer, this.copyMaterial, this.renderToScreen ? null : writeBuffer);\n        if (this.isBouncing) {\n          if (this.isBlur) this.copyMaterial.uniforms['tDiffuse'].value = this.blurRenderTarget2.texture;else this.copyMaterial.uniforms['tDiffuse'].value = this.beautyRenderTarget.texture;\n          this.copyMaterial.blending = NoBlending;\n          this.renderPass(renderer, this.copyMaterial, this.prevRenderTarget);\n          this.copyMaterial.uniforms['tDiffuse'].value = this.ssrRenderTarget.texture;\n          this.copyMaterial.blending = NormalBlending;\n          this.renderPass(renderer, this.copyMaterial, this.prevRenderTarget);\n        }\n        break;\n      case SSRPass.OUTPUT.Beauty:\n        this.copyMaterial.uniforms['tDiffuse'].value = this.beautyRenderTarget.texture;\n        this.copyMaterial.blending = NoBlending;\n        this.renderPass(renderer, this.copyMaterial, this.renderToScreen ? null : writeBuffer);\n        break;\n      case SSRPass.OUTPUT.Depth:\n        this.renderPass(renderer, this.depthRenderMaterial, this.renderToScreen ? null : writeBuffer);\n        break;\n      case SSRPass.OUTPUT.Normal:\n        this.copyMaterial.uniforms['tDiffuse'].value = this.normalRenderTarget.texture;\n        this.copyMaterial.blending = NoBlending;\n        this.renderPass(renderer, this.copyMaterial, this.renderToScreen ? null : writeBuffer);\n        break;\n      case SSRPass.OUTPUT.Metalness:\n        this.copyMaterial.uniforms['tDiffuse'].value = this.metalnessRenderTarget.texture;\n        this.copyMaterial.blending = NoBlending;\n        this.renderPass(renderer, this.copyMaterial, this.renderToScreen ? null : writeBuffer);\n        break;\n      default:\n        console.warn('THREE.SSRPass: Unknown output type.');\n    }\n  },\n  renderPass: function (renderer, passMaterial, renderTarget, clearColor, clearAlpha) {\n    // save original state\n    this.originalClearColor.copy(renderer.getClearColor(this.tempColor));\n    var originalClearAlpha = renderer.getClearAlpha(this.tempColor);\n    var originalAutoClear = renderer.autoClear;\n    renderer.setRenderTarget(renderTarget); // setup pass state\n\n    renderer.autoClear = false;\n    if (clearColor !== undefined && clearColor !== null) {\n      renderer.setClearColor(clearColor);\n      renderer.setClearAlpha(clearAlpha || 0.0);\n      renderer.clear();\n    }\n    this.fsQuad.material = passMaterial;\n    this.fsQuad.render(renderer); // restore original state\n\n    renderer.autoClear = originalAutoClear;\n    renderer.setClearColor(this.originalClearColor);\n    renderer.setClearAlpha(originalClearAlpha);\n  },\n  renderOverride: function (renderer, overrideMaterial, renderTarget, clearColor, clearAlpha) {\n    this.originalClearColor.copy(renderer.getClearColor(this.tempColor));\n    var originalClearAlpha = renderer.getClearAlpha(this.tempColor);\n    var originalAutoClear = renderer.autoClear;\n    renderer.setRenderTarget(renderTarget);\n    renderer.autoClear = false;\n    clearColor = overrideMaterial.clearColor || clearColor;\n    clearAlpha = overrideMaterial.clearAlpha || clearAlpha;\n    if (clearColor !== undefined && clearColor !== null) {\n      renderer.setClearColor(clearColor);\n      renderer.setClearAlpha(clearAlpha || 0.0);\n      renderer.clear();\n    }\n    this.scene.overrideMaterial = overrideMaterial;\n    renderer.render(this.scene, this.camera);\n    this.scene.overrideMaterial = null; // restore original state\n\n    renderer.autoClear = originalAutoClear;\n    renderer.setClearColor(this.originalClearColor);\n    renderer.setClearAlpha(originalClearAlpha);\n  },\n  renderMetalness: function (renderer, overrideMaterial, renderTarget, clearColor, clearAlpha) {\n    this.originalClearColor.copy(renderer.getClearColor(this.tempColor));\n    var originalClearAlpha = renderer.getClearAlpha(this.tempColor);\n    var originalAutoClear = renderer.autoClear;\n    renderer.setRenderTarget(renderTarget);\n    renderer.autoClear = false;\n    clearColor = overrideMaterial.clearColor || clearColor;\n    clearAlpha = overrideMaterial.clearAlpha || clearAlpha;\n    if (clearColor !== undefined && clearColor !== null) {\n      renderer.setClearColor(clearColor);\n      renderer.setClearAlpha(clearAlpha || 0.0);\n      renderer.clear();\n    }\n    this.scene.traverseVisible(child => {\n      child._SSRPassMaterialBack = child.material;\n      if (this._selects.includes(child)) {\n        child.material = this.metalnessOnMaterial;\n      } else {\n        child.material = this.metalnessOffMaterial;\n      }\n    });\n    renderer.render(this.scene, this.camera);\n    this.scene.traverseVisible(child => {\n      child.material = child._SSRPassMaterialBack;\n    }); // restore original state\n\n    renderer.autoClear = originalAutoClear;\n    renderer.setClearColor(this.originalClearColor);\n    renderer.setClearAlpha(originalClearAlpha);\n  },\n  setSize: function (width, height) {\n    this.width = width;\n    this.height = height;\n    this.ssrMaterial.defines.MAX_STEP = Math.sqrt(width * width + height * height);\n    this.ssrMaterial.needsUpdate = true;\n    this.beautyRenderTarget.setSize(width, height);\n    this.prevRenderTarget.setSize(width, height);\n    this.ssrRenderTarget.setSize(width, height);\n    this.normalRenderTarget.setSize(width, height); // if (this.isSelective)\n\n    this.metalnessRenderTarget.setSize(width, height);\n    this.blurRenderTarget.setSize(width, height);\n    this.blurRenderTarget2.setSize(width, height); // this.blurRenderTarget3.setSize(width, height);\n\n    this.ssrMaterial.uniforms['resolution'].value.set(width, height);\n    this.ssrMaterial.uniforms['cameraProjectionMatrix'].value.copy(this.camera.projectionMatrix);\n    this.ssrMaterial.uniforms['cameraInverseProjectionMatrix'].value.copy(this.camera.projectionMatrixInverse);\n    this.blurMaterial.uniforms['resolution'].value.set(width, height);\n    this.blurMaterial2.uniforms['resolution'].value.set(width, height);\n  }\n});\nSSRPass.OUTPUT = {\n  Default: 0,\n  SSR: 1,\n  Beauty: 3,\n  Depth: 4,\n  Normal: 5,\n  Metalness: 7\n};\nexport { SSRPass };","map":{"version":3,"names":["Color","DepthTexture","UnsignedShortType","NearestFilter","WebGLRenderTarget","LinearFilter","RGBAFormat","HalfFloatType","ShaderMaterial","UniformsUtils","NoBlending","MeshNormalMaterial","MeshBasicMaterial","SrcAlphaFactor","OneMinusSrcAlphaFactor","AddEquation","NormalBlending","FullScreenQuad","Pass","SSRShader","SSRBlurShader","SSRDepthShader","CopyShader","SSRPass","renderer","scene","camera","width","height","selects","encoding","isPerspectiveCamera","isBouncing","morphTargets","groundReflector","undefined","clear","opacity","uniforms","value","output","maxDistance","surfDist","tempColor","_selects","isSelective","Array","isArray","Object","defineProperty","get","set","val","ssrMaterial","defines","needsUpdate","_isBouncing","prevRenderTarget","texture","beautyRenderTarget","isBlur","_isDistanceAttenuation","isDistanceAttenuation","_isFresnel","isFresnel","_isInfiniteThick","isInfiniteThick","thickTolerance","depthTexture","type","minFilter","maxFilter","magFilter","format","depthBuffer","normalRenderTarget","metalnessRenderTarget","ssrRenderTarget","blurRenderTarget","clone","blurRenderTarget2","console","error","assign","MAX_STEP","Math","sqrt","window","innerWidth","innerHeight","vertexShader","fragmentShader","blending","near","far","copy","projectionMatrix","projectionMatrixInverse","normalMaterial","metalnessOnMaterial","color","metalnessOffMaterial","blurMaterial","blurMaterial2","depthRenderMaterial","copyMaterial","transparent","depthTest","depthWrite","blendSrc","blendDst","blendEquation","blendSrcAlpha","blendDstAlpha","blendEquationAlpha","fsQuad","originalClearColor","prototype","create","constructor","dispose","render","writeBuffer","setRenderTarget","doRender","visible","renderOverride","renderMetalness","renderPass","OUTPUT","Default","renderToScreen","SSR","Beauty","Depth","Normal","Metalness","warn","passMaterial","renderTarget","clearColor","clearAlpha","getClearColor","originalClearAlpha","getClearAlpha","originalAutoClear","autoClear","setClearColor","setClearAlpha","material","overrideMaterial","traverseVisible","child","_SSRPassMaterialBack","includes","setSize"],"sources":["/Users/tumolabsstudent/Desktop/app/node_modules/three-stdlib/postprocessing/SSRPass.js"],"sourcesContent":["import { Color, DepthTexture, UnsignedShortType, NearestFilter, WebGLRenderTarget, LinearFilter, RGBAFormat, HalfFloatType, ShaderMaterial, UniformsUtils, NoBlending, MeshNormalMaterial, MeshBasicMaterial, SrcAlphaFactor, OneMinusSrcAlphaFactor, AddEquation, NormalBlending } from 'three';\nimport { FullScreenQuad, Pass } from './Pass.js';\nimport { SSRShader, SSRBlurShader, SSRDepthShader } from '../shaders/SSRShader.js';\nimport { CopyShader } from '../shaders/CopyShader.js';\n\nvar SSRPass = function ({\n  renderer,\n  scene,\n  camera,\n  width,\n  height,\n  selects,\n  encoding,\n  isPerspectiveCamera = true,\n  isBouncing = false,\n  morphTargets = false,\n  groundReflector\n}) {\n  this.width = width !== undefined ? width : 512;\n  this.height = height !== undefined ? height : 512;\n  this.clear = true;\n  this.renderer = renderer;\n  this.scene = scene;\n  this.camera = camera;\n  this.groundReflector = groundReflector;\n  this.opacity = SSRShader.uniforms.opacity.value;\n  this.output = 0;\n  this.maxDistance = SSRShader.uniforms.maxDistance.value;\n  this.surfDist = SSRShader.uniforms.surfDist.value;\n  this.encoding = encoding;\n  this.tempColor = new Color();\n  this._selects = selects;\n  this.isSelective = Array.isArray(this._selects);\n  Object.defineProperty(this, 'selects', {\n    get() {\n      return this._selects;\n    },\n\n    set(val) {\n      if (this._selects === val) return;\n      this._selects = val;\n\n      if (Array.isArray(val)) {\n        this.isSelective = true;\n        this.ssrMaterial.defines.isSelective = true;\n        this.ssrMaterial.needsUpdate = true;\n      } else {\n        this.isSelective = false;\n        this.ssrMaterial.defines.isSelective = false;\n        this.ssrMaterial.needsUpdate = true;\n      }\n    }\n\n  });\n  this._isBouncing = isBouncing; ///todo: don't need defineProperty\n\n  Object.defineProperty(this, 'isBouncing', {\n    get() {\n      return this._isBouncing;\n    },\n\n    set(val) {\n      if (this._isBouncing === val) return;\n      this._isBouncing = val;\n\n      if (val) {\n        this.ssrMaterial.uniforms['tDiffuse'].value = this.prevRenderTarget.texture;\n      } else {\n        this.ssrMaterial.uniforms['tDiffuse'].value = this.beautyRenderTarget.texture;\n      }\n    }\n\n  });\n  this.isBlur = true;\n  this._isDistanceAttenuation = SSRShader.defines.isDistanceAttenuation;\n  Object.defineProperty(this, 'isDistanceAttenuation', {\n    get() {\n      return this._isDistanceAttenuation;\n    },\n\n    set(val) {\n      if (this._isDistanceAttenuation === val) return;\n      this._isDistanceAttenuation = val;\n      this.ssrMaterial.defines.isDistanceAttenuation = val;\n      this.ssrMaterial.needsUpdate = true;\n    }\n\n  });\n  this._isFresnel = SSRShader.defines.isFresnel;\n  Object.defineProperty(this, 'isFresnel', {\n    get() {\n      return this._isFresnel;\n    },\n\n    set(val) {\n      if (this._isFresnel === val) return;\n      this._isFresnel = val;\n      this.ssrMaterial.defines.isFresnel = val;\n      this.ssrMaterial.needsUpdate = true;\n    }\n\n  });\n  this._isInfiniteThick = SSRShader.defines.isInfiniteThick;\n  Object.defineProperty(this, 'isInfiniteThick', {\n    get() {\n      return this._isInfiniteThick;\n    },\n\n    set(val) {\n      if (this._isInfiniteThick === val) return;\n      this._isInfiniteThick = val;\n      this.ssrMaterial.defines.isInfiniteThick = val;\n      this.ssrMaterial.needsUpdate = true;\n    }\n\n  });\n  this.thickTolerance = SSRShader.uniforms.thickTolerance.value; // beauty render target with depth buffer\n\n  var depthTexture = new DepthTexture();\n  depthTexture.type = UnsignedShortType;\n  depthTexture.minFilter = NearestFilter;\n  depthTexture.maxFilter = NearestFilter;\n  this.beautyRenderTarget = new WebGLRenderTarget(this.width, this.height, {\n    minFilter: LinearFilter,\n    magFilter: LinearFilter,\n    format: RGBAFormat,\n    depthTexture: depthTexture,\n    depthBuffer: true\n  }); //for bouncing\n\n  this.prevRenderTarget = new WebGLRenderTarget(this.width, this.height, {\n    minFilter: LinearFilter,\n    magFilter: LinearFilter,\n    format: RGBAFormat\n  }); // normal render target\n\n  this.normalRenderTarget = new WebGLRenderTarget(this.width, this.height, {\n    minFilter: NearestFilter,\n    magFilter: NearestFilter,\n    format: RGBAFormat,\n    type: HalfFloatType\n  }); // metalness render target\n  // if (this.isSelective) {\n\n  this.metalnessRenderTarget = new WebGLRenderTarget(this.width, this.height, {\n    minFilter: NearestFilter,\n    magFilter: NearestFilter,\n    format: RGBAFormat\n  }); // }\n  // ssr render target\n\n  this.ssrRenderTarget = new WebGLRenderTarget(this.width, this.height, {\n    minFilter: LinearFilter,\n    magFilter: LinearFilter,\n    format: RGBAFormat\n  });\n  this.blurRenderTarget = this.ssrRenderTarget.clone();\n  this.blurRenderTarget2 = this.ssrRenderTarget.clone(); // this.blurRenderTarget3 = this.ssrRenderTarget.clone();\n  // ssr material\n\n  if (SSRShader === undefined) {\n    console.error('THREE.SSRPass: The pass relies on SSRShader.');\n  }\n\n  this.ssrMaterial = new ShaderMaterial({\n    defines: Object.assign({\n      MAX_STEP: Math.sqrt(window.innerWidth * window.innerWidth + window.innerHeight * window.innerHeight)\n    }, SSRShader.defines),\n    uniforms: UniformsUtils.clone(SSRShader.uniforms),\n    vertexShader: SSRShader.vertexShader,\n    fragmentShader: SSRShader.fragmentShader,\n    blending: NoBlending\n  });\n\n  if (!isPerspectiveCamera) {\n    this.ssrMaterial.defines.isPerspectiveCamera = isPerspectiveCamera;\n    this.ssrMaterial.needsUpdate = true;\n  }\n\n  this.ssrMaterial.uniforms['tDiffuse'].value = this.beautyRenderTarget.texture;\n  this.ssrMaterial.uniforms['tNormal'].value = this.normalRenderTarget.texture; // if (this.isSelective) {\n\n  this.ssrMaterial.defines.isSelective = this.isSelective;\n  this.ssrMaterial.needsUpdate = true;\n  this.ssrMaterial.uniforms['tMetalness'].value = this.metalnessRenderTarget.texture; // }\n\n  this.ssrMaterial.uniforms['tDepth'].value = this.beautyRenderTarget.depthTexture;\n  this.ssrMaterial.uniforms['cameraNear'].value = this.camera.near;\n  this.ssrMaterial.uniforms['cameraFar'].value = this.camera.far;\n  this.ssrMaterial.uniforms['surfDist'].value = this.surfDist;\n  this.ssrMaterial.uniforms['resolution'].value.set(this.width, this.height);\n  this.ssrMaterial.uniforms['cameraProjectionMatrix'].value.copy(this.camera.projectionMatrix);\n  this.ssrMaterial.uniforms['cameraInverseProjectionMatrix'].value.copy(this.camera.projectionMatrixInverse); // normal material\n\n  this.normalMaterial = new MeshNormalMaterial({\n    morphTargets\n  });\n  this.normalMaterial.blending = NoBlending; // if (this.isSelective) {\n  // metalnessOn material\n\n  this.metalnessOnMaterial = new MeshBasicMaterial({\n    color: 'white'\n  }); // metalnessOff material\n\n  this.metalnessOffMaterial = new MeshBasicMaterial({\n    color: 'black'\n  }); // }\n  // blur material\n\n  this.blurMaterial = new ShaderMaterial({\n    defines: Object.assign({}, SSRBlurShader.defines),\n    uniforms: UniformsUtils.clone(SSRBlurShader.uniforms),\n    vertexShader: SSRBlurShader.vertexShader,\n    fragmentShader: SSRBlurShader.fragmentShader\n  });\n  this.blurMaterial.uniforms['tDiffuse'].value = this.ssrRenderTarget.texture;\n  this.blurMaterial.uniforms['resolution'].value.set(this.width, this.height); // blur material 2\n\n  this.blurMaterial2 = new ShaderMaterial({\n    defines: Object.assign({}, SSRBlurShader.defines),\n    uniforms: UniformsUtils.clone(SSRBlurShader.uniforms),\n    vertexShader: SSRBlurShader.vertexShader,\n    fragmentShader: SSRBlurShader.fragmentShader\n  });\n  this.blurMaterial2.uniforms['tDiffuse'].value = this.blurRenderTarget.texture;\n  this.blurMaterial2.uniforms['resolution'].value.set(this.width, this.height); // // blur material 3\n  // this.blurMaterial3 = new ShaderMaterial({\n  //   defines: Object.assign({}, SSRBlurShader.defines),\n  //   uniforms: UniformsUtils.clone(SSRBlurShader.uniforms),\n  //   vertexShader: SSRBlurShader.vertexShader,\n  //   fragmentShader: SSRBlurShader.fragmentShader\n  // });\n  // this.blurMaterial3.uniforms['tDiffuse'].value = this.blurRenderTarget2.texture;\n  // this.blurMaterial3.uniforms['resolution'].value.set(this.width, this.height);\n  // material for rendering the depth\n\n  this.depthRenderMaterial = new ShaderMaterial({\n    defines: Object.assign({}, SSRDepthShader.defines),\n    uniforms: UniformsUtils.clone(SSRDepthShader.uniforms),\n    vertexShader: SSRDepthShader.vertexShader,\n    fragmentShader: SSRDepthShader.fragmentShader,\n    blending: NoBlending\n  });\n  this.depthRenderMaterial.uniforms['tDepth'].value = this.beautyRenderTarget.depthTexture;\n  this.depthRenderMaterial.uniforms['cameraNear'].value = this.camera.near;\n  this.depthRenderMaterial.uniforms['cameraFar'].value = this.camera.far; // material for rendering the content of a render target\n\n  this.copyMaterial = new ShaderMaterial({\n    uniforms: UniformsUtils.clone(CopyShader.uniforms),\n    vertexShader: CopyShader.vertexShader,\n    fragmentShader: CopyShader.fragmentShader,\n    transparent: true,\n    depthTest: false,\n    depthWrite: false,\n    blendSrc: SrcAlphaFactor,\n    blendDst: OneMinusSrcAlphaFactor,\n    blendEquation: AddEquation,\n    blendSrcAlpha: SrcAlphaFactor,\n    blendDstAlpha: OneMinusSrcAlphaFactor,\n    blendEquationAlpha: AddEquation // premultipliedAlpha:true,\n\n  });\n  this.fsQuad = new FullScreenQuad(null);\n  this.originalClearColor = new Color();\n};\n\nSSRPass.prototype = Object.assign(Object.create(Pass.prototype), {\n  constructor: SSRPass,\n  dispose: function () {\n    // dispose render targets\n    this.beautyRenderTarget.dispose();\n    this.prevRenderTarget.dispose();\n    this.normalRenderTarget.dispose(); // if (this.isSelective)\n\n    this.metalnessRenderTarget.dispose();\n    this.ssrRenderTarget.dispose();\n    this.blurRenderTarget.dispose();\n    this.blurRenderTarget2.dispose(); // this.blurRenderTarget3.dispose();\n    // dispose materials\n\n    this.normalMaterial.dispose(); // if (this.isSelective) {\n\n    this.metalnessOnMaterial.dispose();\n    this.metalnessOffMaterial.dispose(); // }\n\n    this.blurMaterial.dispose();\n    this.blurMaterial2.dispose();\n    this.copyMaterial.dispose();\n    this.depthRenderMaterial.dispose(); // dipsose full screen quad\n\n    this.fsQuad.dispose();\n  },\n  render: function (renderer, writeBuffer\n  /*, readBuffer, deltaTime, maskActive */\n  ) {\n    // render beauty and depth\n    if (this.encoding) this.beautyRenderTarget.texture.encoding = this.encoding;\n    renderer.setRenderTarget(this.beautyRenderTarget);\n    renderer.clear();\n\n    if (this.groundReflector) {\n      this.groundReflector.doRender(this.renderer, this.scene, this.camera);\n      this.groundReflector.visible = true;\n    }\n\n    renderer.render(this.scene, this.camera);\n    if (this.groundReflector) this.groundReflector.visible = false; // render normals\n\n    this.renderOverride(renderer, this.normalMaterial, this.normalRenderTarget, 0, 0); // render metalnesses\n\n    if (this.isSelective) {\n      this.renderMetalness(renderer, this.metalnessOnMaterial, this.metalnessRenderTarget, 0, 0);\n    } // render SSR\n\n\n    this.ssrMaterial.uniforms['opacity'].value = this.opacity;\n    this.ssrMaterial.uniforms['maxDistance'].value = this.maxDistance;\n    this.ssrMaterial.uniforms['surfDist'].value = this.surfDist;\n    this.ssrMaterial.uniforms['thickTolerance'].value = this.thickTolerance;\n    this.renderPass(renderer, this.ssrMaterial, this.ssrRenderTarget); // render blur\n\n    if (this.isBlur) {\n      this.renderPass(renderer, this.blurMaterial, this.blurRenderTarget);\n      this.renderPass(renderer, this.blurMaterial2, this.blurRenderTarget2); // this.renderPass(renderer, this.blurMaterial3, this.blurRenderTarget3);\n    } // output result to screen\n\n\n    switch (this.output) {\n      case SSRPass.OUTPUT.Default:\n        if (this.isBouncing) {\n          this.copyMaterial.uniforms['tDiffuse'].value = this.beautyRenderTarget.texture;\n          this.copyMaterial.blending = NoBlending;\n          this.renderPass(renderer, this.copyMaterial, this.prevRenderTarget);\n          if (this.isBlur) this.copyMaterial.uniforms['tDiffuse'].value = this.blurRenderTarget2.texture;else this.copyMaterial.uniforms['tDiffuse'].value = this.ssrRenderTarget.texture;\n          this.copyMaterial.blending = NormalBlending;\n          this.renderPass(renderer, this.copyMaterial, this.prevRenderTarget);\n          this.copyMaterial.uniforms['tDiffuse'].value = this.prevRenderTarget.texture;\n          this.copyMaterial.blending = NoBlending;\n          this.renderPass(renderer, this.copyMaterial, this.renderToScreen ? null : writeBuffer);\n        } else {\n          this.copyMaterial.uniforms['tDiffuse'].value = this.beautyRenderTarget.texture;\n          this.copyMaterial.blending = NoBlending;\n          this.renderPass(renderer, this.copyMaterial, this.renderToScreen ? null : writeBuffer);\n          if (this.isBlur) this.copyMaterial.uniforms['tDiffuse'].value = this.blurRenderTarget2.texture;else this.copyMaterial.uniforms['tDiffuse'].value = this.ssrRenderTarget.texture;\n          this.copyMaterial.blending = NormalBlending;\n          this.renderPass(renderer, this.copyMaterial, this.renderToScreen ? null : writeBuffer);\n        }\n\n        break;\n\n      case SSRPass.OUTPUT.SSR:\n        if (this.isBlur) this.copyMaterial.uniforms['tDiffuse'].value = this.blurRenderTarget2.texture;else this.copyMaterial.uniforms['tDiffuse'].value = this.ssrRenderTarget.texture;\n        this.copyMaterial.blending = NoBlending;\n        this.renderPass(renderer, this.copyMaterial, this.renderToScreen ? null : writeBuffer);\n\n        if (this.isBouncing) {\n          if (this.isBlur) this.copyMaterial.uniforms['tDiffuse'].value = this.blurRenderTarget2.texture;else this.copyMaterial.uniforms['tDiffuse'].value = this.beautyRenderTarget.texture;\n          this.copyMaterial.blending = NoBlending;\n          this.renderPass(renderer, this.copyMaterial, this.prevRenderTarget);\n          this.copyMaterial.uniforms['tDiffuse'].value = this.ssrRenderTarget.texture;\n          this.copyMaterial.blending = NormalBlending;\n          this.renderPass(renderer, this.copyMaterial, this.prevRenderTarget);\n        }\n\n        break;\n\n      case SSRPass.OUTPUT.Beauty:\n        this.copyMaterial.uniforms['tDiffuse'].value = this.beautyRenderTarget.texture;\n        this.copyMaterial.blending = NoBlending;\n        this.renderPass(renderer, this.copyMaterial, this.renderToScreen ? null : writeBuffer);\n        break;\n\n      case SSRPass.OUTPUT.Depth:\n        this.renderPass(renderer, this.depthRenderMaterial, this.renderToScreen ? null : writeBuffer);\n        break;\n\n      case SSRPass.OUTPUT.Normal:\n        this.copyMaterial.uniforms['tDiffuse'].value = this.normalRenderTarget.texture;\n        this.copyMaterial.blending = NoBlending;\n        this.renderPass(renderer, this.copyMaterial, this.renderToScreen ? null : writeBuffer);\n        break;\n\n      case SSRPass.OUTPUT.Metalness:\n        this.copyMaterial.uniforms['tDiffuse'].value = this.metalnessRenderTarget.texture;\n        this.copyMaterial.blending = NoBlending;\n        this.renderPass(renderer, this.copyMaterial, this.renderToScreen ? null : writeBuffer);\n        break;\n\n      default:\n        console.warn('THREE.SSRPass: Unknown output type.');\n    }\n  },\n  renderPass: function (renderer, passMaterial, renderTarget, clearColor, clearAlpha) {\n    // save original state\n    this.originalClearColor.copy(renderer.getClearColor(this.tempColor));\n    var originalClearAlpha = renderer.getClearAlpha(this.tempColor);\n    var originalAutoClear = renderer.autoClear;\n    renderer.setRenderTarget(renderTarget); // setup pass state\n\n    renderer.autoClear = false;\n\n    if (clearColor !== undefined && clearColor !== null) {\n      renderer.setClearColor(clearColor);\n      renderer.setClearAlpha(clearAlpha || 0.0);\n      renderer.clear();\n    }\n\n    this.fsQuad.material = passMaterial;\n    this.fsQuad.render(renderer); // restore original state\n\n    renderer.autoClear = originalAutoClear;\n    renderer.setClearColor(this.originalClearColor);\n    renderer.setClearAlpha(originalClearAlpha);\n  },\n  renderOverride: function (renderer, overrideMaterial, renderTarget, clearColor, clearAlpha) {\n    this.originalClearColor.copy(renderer.getClearColor(this.tempColor));\n    var originalClearAlpha = renderer.getClearAlpha(this.tempColor);\n    var originalAutoClear = renderer.autoClear;\n    renderer.setRenderTarget(renderTarget);\n    renderer.autoClear = false;\n    clearColor = overrideMaterial.clearColor || clearColor;\n    clearAlpha = overrideMaterial.clearAlpha || clearAlpha;\n\n    if (clearColor !== undefined && clearColor !== null) {\n      renderer.setClearColor(clearColor);\n      renderer.setClearAlpha(clearAlpha || 0.0);\n      renderer.clear();\n    }\n\n    this.scene.overrideMaterial = overrideMaterial;\n    renderer.render(this.scene, this.camera);\n    this.scene.overrideMaterial = null; // restore original state\n\n    renderer.autoClear = originalAutoClear;\n    renderer.setClearColor(this.originalClearColor);\n    renderer.setClearAlpha(originalClearAlpha);\n  },\n  renderMetalness: function (renderer, overrideMaterial, renderTarget, clearColor, clearAlpha) {\n    this.originalClearColor.copy(renderer.getClearColor(this.tempColor));\n    var originalClearAlpha = renderer.getClearAlpha(this.tempColor);\n    var originalAutoClear = renderer.autoClear;\n    renderer.setRenderTarget(renderTarget);\n    renderer.autoClear = false;\n    clearColor = overrideMaterial.clearColor || clearColor;\n    clearAlpha = overrideMaterial.clearAlpha || clearAlpha;\n\n    if (clearColor !== undefined && clearColor !== null) {\n      renderer.setClearColor(clearColor);\n      renderer.setClearAlpha(clearAlpha || 0.0);\n      renderer.clear();\n    }\n\n    this.scene.traverseVisible(child => {\n      child._SSRPassMaterialBack = child.material;\n\n      if (this._selects.includes(child)) {\n        child.material = this.metalnessOnMaterial;\n      } else {\n        child.material = this.metalnessOffMaterial;\n      }\n    });\n    renderer.render(this.scene, this.camera);\n    this.scene.traverseVisible(child => {\n      child.material = child._SSRPassMaterialBack;\n    }); // restore original state\n\n    renderer.autoClear = originalAutoClear;\n    renderer.setClearColor(this.originalClearColor);\n    renderer.setClearAlpha(originalClearAlpha);\n  },\n  setSize: function (width, height) {\n    this.width = width;\n    this.height = height;\n    this.ssrMaterial.defines.MAX_STEP = Math.sqrt(width * width + height * height);\n    this.ssrMaterial.needsUpdate = true;\n    this.beautyRenderTarget.setSize(width, height);\n    this.prevRenderTarget.setSize(width, height);\n    this.ssrRenderTarget.setSize(width, height);\n    this.normalRenderTarget.setSize(width, height); // if (this.isSelective)\n\n    this.metalnessRenderTarget.setSize(width, height);\n    this.blurRenderTarget.setSize(width, height);\n    this.blurRenderTarget2.setSize(width, height); // this.blurRenderTarget3.setSize(width, height);\n\n    this.ssrMaterial.uniforms['resolution'].value.set(width, height);\n    this.ssrMaterial.uniforms['cameraProjectionMatrix'].value.copy(this.camera.projectionMatrix);\n    this.ssrMaterial.uniforms['cameraInverseProjectionMatrix'].value.copy(this.camera.projectionMatrixInverse);\n    this.blurMaterial.uniforms['resolution'].value.set(width, height);\n    this.blurMaterial2.uniforms['resolution'].value.set(width, height);\n  }\n});\nSSRPass.OUTPUT = {\n  Default: 0,\n  SSR: 1,\n  Beauty: 3,\n  Depth: 4,\n  Normal: 5,\n  Metalness: 7\n};\n\nexport { SSRPass };\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}